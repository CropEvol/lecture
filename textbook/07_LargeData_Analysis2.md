# <a name="section0">大規模データ解析入門2</a>  

今回勉強すること
- Pythonを使ったデータ解析
- グラフ描画

## Pythonを使ったデータ解析
　今回は、Pandasと呼ばれる便利なライブラリ（拡張パッケージみたいなもの）を使って、テキストファイルを読み込み、データ解析します。

- Pandasについて
- 取り扱うデータ
- 演習

### Pandasについて
　Pandasは、図のような行列データの取り扱いを得意としたライブラリです。図では、一行に１個体分のデータで、各列にはその列名に関するデータが並んでいます。  このような構造のデータを、Pandasでは __データフレーム__ と呼んでいます。

<div style="margin-bottom: 5px;"><img src="../images/07/07_dataframe.png" height="100px" alt="dataframe"></div>

　Pandasを使うと、次のような処理が可能になります。

- for文を使わずに列同士の演算ができます。
- if文を使わずに条件に合うデータのみを抽出できます。

　Pandas内部で最適なデータ処理がされるため、自身でfor文やif文を書いてデータ処理するよりも、高速にデータ処理できます(*1)。なによりも、一行のコードで上のような処理ができるため、書くコードの量も少なくて済みます。  

*1 Pandasが苦手とするような処理（反対に時間がかかる処理）もあります。

### 取り扱うデータ
　今回は仮想の生物のゲノム情報を扱います。この仮想生物は染色体を1本だけもつ一倍体生物です。  
　この生物には赤色の個体と白色の個体がいます（このような違いのことを__多型__という）。色の違う2個体のゲノムを調べたところ、ゲノム上に等間隔で分布する50個の遺伝子に違いが見られました。それら遺伝子について、赤色個体のアリル（対立遺伝子）を`R`、白色個体のアリルを`W`とすると、2個体は図のように表現できます。この50個の遺伝子のうち、1個が色に関わる遺伝子です。その遺伝子を見つけるのが今回の解析です。

　色遺伝子を見つけるために、赤色個体と白色個体を交配し、染色体の様々な領域に組換えが生じた子孫集団200個体を作成しました。そして、子孫集団の表現型（赤色か白色か）を調べ、また、50遺伝子の遺伝子型（どちらの親由来のアリルを持っているか）も調べました。

　色遺伝子であれば、子孫集団の赤色個体はすべて`R`アリルに、かつ、白色個体はすべて`W`アリルになっているはずです。色の違いに関与しない遺伝子はその限りではありません。

<div style="margin-bottom: 5px;"><img src="../images/07/07_population.png" height="200px" alt="dataframe"></div>

　そこで、50遺伝子の中から、条件に合う遺伝子を見つけるために、子孫集団を赤色個体グループと白色個体グループに分け、両グループで各遺伝子のアリル数をカウントしました。その結果をまとめたのが次の2データです。以降はこれらデータを使用していきます。

1) 子孫集団の赤色個体における各遺伝子のアリル数  
[https://raw.githubusercontent.com/CropEvol/lecture/master/data/L07_allele_in_red.txt](https://raw.githubusercontent.com/CropEvol/lecture/master/data/L07_allele_in_red.txt)  
エディタに貼り付けて、 `L07_allele_in_red.txt` という名前で保存し、講義用の`genome`フォルダに入れてください。

2) 子孫集団の白色個体における各遺伝子のアリル数  
[https://raw.githubusercontent.com/CropEvol/lecture/master/data/L07_allele_in_white.txt](https://raw.githubusercontent.com/CropEvol/lecture/master/data/L07_allele_in_white.txt)  
エディタに貼り付けて、 `L07_allele_in_white.txt` という名前で保存し、講義用の`genome`フォルダに入れてください。

### 演習
　演習は、Pandasデータフレームの扱い方を勉強した後、データ解析をしていきます。

勉強する内容は次のとおりです。
1. データの読み込み
1. 行方向のデータ抽出
1. 列方向のデータ抽出
1. 任意セルのデータ抽出
1. データ解析

### 1. データの読み込み
　データを読み込んでみましょう。今回のデータもタブ区切りテキストファイルです。

```
import pandas as pd     # pandasライブラリの読み込み

# タブ区切りテキストの読み込み
df_r = pd.read_csv('L07_allele_in_red.txt', sep='\t', header=0)
df_w = pd.read_csv('L07_allele_in_white.txt', sep='\t', header=0)

######## メモ ########
# ----------------------
# import ライブラリ名 (as 省略名)
# ----------------------
# ライブラリの読み込み
# import pandas as pd では、
# pandasライブラリをpdという名前で使えるようにしています。
#
# ----------------------
# pd.read_csv()
# ----------------------
# ファイルをpandasデータフレームとして読み込む関数
# 読み込むファイルは第一引数に指定。
# sepオプションで区切り文字を指定。
#   sep='\t' はタブ区切り
#   sep=','  はカンマ区切り
# headerオプションでヘッダー行（列名の行;）の行番号を指定。
#   行番号は0スタートであるため、
#   header=0 は一番上の行がヘッダー行であることを示す
#   header=-1 で「ヘッダー行なし」を指定
```

　データフレームの中身を確認したい場合は、コードの最後の行や別のセルに、データフレームの変数名を書いてください。

```
df_r      # 表示

######## メモ ########
# Jupyter Notebookでは、
# 変数名のみをコードの最後に書くことで、
# print関数を使わず、出力することができます。
#
# この出力方法は、1セルにつき1つ、
# かつ、コードの最後に書いた変数に有効です。
# コード途中の変数名のみの行は出力されません。
```

### 2. 行方向のデータ抽出

### 3. 列方向のデータ抽出

### 4. 任意セルのデータ抽出

### 5. データ解析



## グラフ描画
　Pythonでできることは、計算やファイルの読み書きだけではありません。折れ線グラフや棒グラフ、その他各種グラフの描画もできます。

- Pythonパッケージ「Matplotlib」で描けるグラフ例  
[https://matplotlib.org/gallery/index.html](https://matplotlib.org/gallery/index.html)

- Pythonパッケージ「Seaborn」で描けるグラフ例  
[http://seaborn.pydata.org/examples/](http://seaborn.pydata.org/examples/)

　Excelでも表からグラフを描けますが、データ量が多くなった場合、描画ができなくなるか、可能だとしても時間がかかります（Excelは大規模データを扱うのに適していないからです）。PythonやRは大規模データを扱うのに適したプログラミング言語です。また、きれいなグラフも描画できます。

　ここでは、Pythonで表のデータを取り扱う練習をし、そのデータからグラフを描いてみましょう。

　
